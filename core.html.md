# fhadmin


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## The idea

The idea is to build an admin panel for apps using FastHTML and SQLite.
I wanna use fastlite to talk to the database and fhdaisy to style the
app. The idea is to have this a standalone app that I can mount into
another app.

Please use your tools to change the messages directly when I prompt you
to change something.

## Setup

``` python
from fastcore.net import urlsave
```

``` python
p = mk_previewer(app)
```

## Database

For development we’ll use the `chinook` sqlite database. This cell
downloads it in the right place if you don’t have it already downloaded.

``` python
url = 'https://github.com/lerocha/chinook-database/raw/master/ChinookDatabase/DataSources/Chinook_Sqlite.sqlite'
path = Path('../data/chinook.sqlite')
if not path.exists(): urlsave(url, path)
```

``` python
db = database("../data/chinook.sqlite")
```

## Configuration

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L36"
target="_blank" style="float:right; font-size:smaller">source</a>

### AdminConfig

``` python

def AdminConfig(
    db_path:str \| pathlib.Path, password:str='admin123'
)->None:

```

``` python
cfg = AdminConfig(db_path="../data/chinook.sqlite", password="admin123")
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L44"
target="_blank" style="float:right; font-size:smaller">source</a>

### create_admin

``` python

def create_admin(
    config
):

```

``` python
app = create_admin(cfg)
```

## Utility Functions

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L49"
target="_blank" style="float:right; font-size:smaller">source</a>

### tbl_name

``` python

def tbl_name(
    t
):

```

``` python
assert tbl_name('"Artist"') == 'Artist'
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L58"
target="_blank" style="float:right; font-size:smaller">source</a>

### url

``` python

def url(
    req, path
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L52"
target="_blank" style="float:right; font-size:smaller">source</a>

### mock_req

``` python

def mock_req(
    root_path:str=''
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L61"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_col_types

``` python

def get_col_types(
    db, t
):

```

``` python
assert get_col_types(app.state.cfg.db, 'Artist') == {'ArtistId': 'INTEGER', 'Name': 'NVARCHAR(120)'}
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L66"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_cols

``` python

def get_cols(
    db, t
):

```

``` python
assert get_cols(app.state.cfg.db, 'Artist') == ['ArtistId', 'Name']
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L71"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_text_cols

``` python

def get_text_cols(
    db, t
):

```

``` python
assert get_text_cols(app.state.cfg.db, 'Artist') == ['Name']
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L75"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_pk_col

``` python

def get_pk_col(
    db, t
):

```

``` python
assert get_pk_col(app.state.cfg.db, 'Artist') == 'ArtistId'
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L82"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_table_info

``` python

def get_table_info(
    db, t
):

```

``` python
assert get_table_info(app.state.cfg.db, 'Artist') == (['ArtistId', 'Name'], 'ArtistId')
```

``` python
# Test SQL queries
dangerous_queries = [
    "DROP TABLE Album",
    "DELETE FROM Track WHERE TrackId > 100",
    "DELETE FROM Artist",  # no WHERE clause
    "UPDATE Track SET Name = 'test'",  # no WHERE clause
    "TRUNCATE TABLE Playlist",
    "ALTER TABLE Album ADD COLUMN test TEXT",
]

safe_queries = [
    "SELECT * FROM Album LIMIT 10",
    "SELECT COUNT(*) FROM Track",
    "SELECT * FROM Artist WHERE ArtistId = 1",
    "SELECT Name, Composer FROM Track WHERE AlbumId = 5",
]
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L91"
target="_blank" style="float:right; font-size:smaller">source</a>

### is_dangerous_query

``` python

def is_dangerous_query(
    query:str
):

```

``` python
assert not is_dangerous_query(safe_queries[0])
assert is_dangerous_query(dangerous_queries[1])
```

## UI Components

``` python
print(LinkButton()), print(LinkButton(cls="-primary"))
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L98"
target="_blank" style="float:right; font-size:smaller">source</a>

### LabeledInput

``` python

def LabeledInput(
    icon_name, kwargs:VAR_KEYWORD
):

```

``` python
p(LabeledInput("lock-closed", placeholder="Password"))
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L106"
target="_blank" style="float:right; font-size:smaller">source</a>

### HeaderBar

``` python

def HeaderBar(
    req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>, logged_in:bool=False
):

```

``` python
p(HeaderBar(logged_in=True))
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L114"
target="_blank" style="float:right; font-size:smaller">source</a>

### Layout

``` python

def Layout(
    children:VAR_POSITIONAL, title:str='Admin', req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>,
    logged_in:bool=False
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L120"
target="_blank" style="float:right; font-size:smaller">source</a>

### NewRowBtn

``` python

def NewRowBtn(
    tbl, req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>
):

```

``` python
p(NewRowBtn("Artist"))
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L123"
target="_blank" style="float:right; font-size:smaller">source</a>

### EditableCell

``` python

def EditableCell(
    tbl, pk, col, val, req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L127"
target="_blank" style="float:right; font-size:smaller">source</a>

### EditCellInput

``` python

def EditCellInput(
    tbl, pk, col, val, req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L132"
target="_blank" style="float:right; font-size:smaller">source</a>

### TableRows

``` python

def TableRows(
    db, rows, cols, tbl, req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L139"
target="_blank" style="float:right; font-size:smaller">source</a>

### NewRowModal

``` python

def NewRowModal(
    tbl, cols, req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L150"
target="_blank" style="float:right; font-size:smaller">source</a>

### SqlConsole

``` python

def SqlConsole(
    tbl, req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L163"
target="_blank" style="float:right; font-size:smaller">source</a>

### DbStats

``` python

def DbStats(
    cfg
):

```

``` python
p(DbStats(cfg))
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L174"
target="_blank" style="float:right; font-size:smaller">source</a>

### TableStats

``` python

def TableStats(
    db, tbl
):

```

``` python
p(TableStats(cfg.db, "Artist"))
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L191"
target="_blank" style="float:right; font-size:smaller">source</a>

### LoginPage

``` python

def LoginPage(
    req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>
):

```

``` python
p(LoginPage())
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L201"
target="_blank" style="float:right; font-size:smaller">source</a>

### TableCard

``` python

def TableCard(
    name, row_count, col_count, req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>
):

```

``` python
p(TableCard("Foobar", 123,123))
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L215"
target="_blank" style="float:right; font-size:smaller">source</a>

### PageBtns

``` python

def PageBtns(
    tbl, page, total_pages, q:str='', req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>
):

```

``` python
p(Div(*PageBtns("Artist", 5, 25), cls="flex gap-2"))
```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L228"
target="_blank" style="float:right; font-size:smaller">source</a>

### SearchForm

``` python

def SearchForm(
    tbl, q:str='', req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>
):

```

``` python
p(SearchForm("Artist"))
```

## Authentication

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L370"
target="_blank" style="float:right; font-size:smaller">source</a>

### post

``` python

def post(
    req, password:str, sess
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L390"
target="_blank" style="float:right; font-size:smaller">source</a>

### get

``` python

def get(
    req
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L370"
target="_blank" style="float:right; font-size:smaller">source</a>

### post

``` python

def post(
    req, sess
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L251"
target="_blank" style="float:right; font-size:smaller">source</a>

### auth_check

``` python

def auth_check(
    req, sess
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L255"
target="_blank" style="float:right; font-size:smaller">source</a>

### DangerousQueryModal

``` python

def DangerousQueryModal(
    tbl, sql, req:Request=<starlette.requests.Request object at 0x7f6d9becbc20>
):

```

``` python
p(DangerousQueryModal("Artist", "DROP TABLE Artist;"))
```

## Tables Overview

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L390"
target="_blank" style="float:right; font-size:smaller">source</a>

### get

``` python

def get(
    req, sess
):

```

## Table Detail View

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L390"
target="_blank" style="float:right; font-size:smaller">source</a>

### get

``` python

def get(
    req, sess, tbl:str, pk:str, col:str
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L390"
target="_blank" style="float:right; font-size:smaller">source</a>

### get

``` python

def get(
    req, sess, tbl:str
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L321"
target="_blank" style="float:right; font-size:smaller">source</a>

### put

``` python

def put(
    req, sess, tbl:str, pk:str, col:str
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L370"
target="_blank" style="float:right; font-size:smaller">source</a>

### post

``` python

def post(
    req, sess, tbl:str
):

```

delete row route

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L333"
target="_blank" style="float:right; font-size:smaller">source</a>

### delete

``` python

def delete(
    req, sess, tbl:str, pk:str
):

```

That’s the route to make a sql query to the db.

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L341"
target="_blank" style="float:right; font-size:smaller">source</a>

### execute_and_render_sql

``` python

def execute_and_render_sql(
    db, sql
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L370"
target="_blank" style="float:right; font-size:smaller">source</a>

### post

``` python

def post(
    req, sess, tbl:str, sql:str
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L370"
target="_blank" style="float:right; font-size:smaller">source</a>

### post

``` python

def post(
    req, sess, tbl:str, sql:str
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L376"
target="_blank" style="float:right; font-size:smaller">source</a>

### search_rows

``` python

def search_rows(
    db, tbl, cols, text_cols, q
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L383"
target="_blank" style="float:right; font-size:smaller">source</a>

### paginate

``` python

def paginate(
    rows, page, per_page:int=25
):

```

------------------------------------------------------------------------

<a
href="https://github.com/vacmar01/fhadmin/blob/main/fhadmin/core.py#L390"
target="_blank" style="float:right; font-size:smaller">source</a>

### get

``` python

def get(
    req, sess, tbl:str, page:int=1, q:str=''
):

```

## Server

``` python
if 'srv' in globals():
    srv.stop()
```

``` python
srv = JupyUvi(app)
```

### Test mounting

``` python
parent = FastHTML()

@parent.get("/foobar")
def home(): return H1("Parent App"), A("Go to Admin", href="/admin/tables")

parent.mount("/admin", app)
```

``` python
if "srv" in globals(): srv.stop()
srv = JupyUvi(parent)
```

``` python
app.routes
```

``` python
parent.routes
```
